/*************************************************************
 * GroupService.cpp
 * Generated by corpc framework corpc_gen.py
 * Create Time: 2022-12-30 10:15:13
 * This file will be overwrite every time
 *************************************************************/

#include <google/protobuf/service.h>
#include <exception>
#include <corpc/common/log.h>
#include "GroupService/pb/GroupService.pb.h"
#include "GroupService/service/GroupService.h"
#include "GroupService/common/business_exception.h"
#include "GroupService/interface/add_group.h"
#include "GroupService/interface/create_group.h"
#include "GroupService/interface/quit_group.h"
#include "GroupService/interface/get_group_users.h"


#define CALL_RPC_INTERFACE(type)                                                                               \
    type impl(*request, *response);                                                                            \
    try {                                                                                                      \
        USER_LOG_INFO << "In|request:{" << request->ShortDebugString() << "}";                                 \
        impl.run();                                                                                            \
        response->set_ret_code(0);                                                                             \
        response->set_res_info("OK");                                                                          \
        USER_LOG_INFO << "Out|response:{" << response->ShortDebugString() << "}";                              \
        if (done) {                                                                                            \
            done->Run();                                                                                       \
        }                                                                                                      \
    }                                                                                                          \
    catch (GroupService::BusinessException &e) {                                                            \
        USER_LOG_ERROR << "[" << e.fileName() << ":" << e.line() << "] occur BusinessException, error code = " \
                       << e.code() << ", errinfo = " << e.error();                                             \
        response->set_ret_code(e.code());                                                                      \
        response->set_res_info(e.error());                                                                     \
        USER_LOG_INFO << "Out|response:{" << response->ShortDebugString() << "}";                              \
        if (done) {                                                                                            \
            done->Run();                                                                                       \
        }                                                                                                      \
    }                                                                                                          \
    catch (std::exception &) {                                                                                 \
        USER_LOG_ERROR << "occur std::exception, error code = -1, errorinfo = Unknown error ";                 \
        response->set_ret_code(-1);                                                                            \
        response->set_res_info("Unknown error");                                                               \
        USER_LOG_INFO << "Out|response:{" << response->ShortDebugString() << "}";                              \
        if (done) {                                                                                            \
            done->Run();                                                                                       \
        }                                                                                                      \
    }                                                                                                          \
    catch (...) {                                                                                              \
        USER_LOG_ERROR << "occur Unknown exception, error code = -1, errorinfo = Unknown error ";              \
        response->set_ret_code(-1);                                                                            \
        response->set_res_info("Unknown error");                                                               \
        USER_LOG_INFO << "Out|response:{" << response->ShortDebugString() << "}";                              \
        if (done) {                                                                                            \
            done->Run();                                                                                       \
        }                                                                                                      \
    }                                                                                                          \
    if (done) {                                                                                                \
        done->Run();                                                                                           \
    }


namespace GroupService {

void GroupServiceRpcImpl::AddGroup(::google::protobuf::RpcController* controller,
                       const ::AddGroupRequest* request,
                       ::AddGroupResponse* response,
                       ::google::protobuf::Closure* done)
{
    CALL_RPC_INTERFACE(AddGroupInterface);
}

void GroupServiceRpcImpl::CreateGroup(::google::protobuf::RpcController* controller,
                       const ::CreateGroupRequest* request,
                       ::CreateGroupResponse* response,
                       ::google::protobuf::Closure* done)
{
    CALL_RPC_INTERFACE(CreateGroupInterface);
}

void GroupServiceRpcImpl::QuitGroup(::google::protobuf::RpcController* controller,
                       const ::QuitGroupRequest* request,
                       ::QuitGroupResponse* response,
                       ::google::protobuf::Closure* done)
{
    CALL_RPC_INTERFACE(QuitGroupInterface);
}

void GroupServiceRpcImpl::GetGroupUsers(::google::protobuf::RpcController* controller,
                       const ::GetGroupUsersRequest* request,
                       ::GetGroupUsersResponse* response,
                       ::google::protobuf::Closure* done)
{
    CALL_RPC_INTERFACE(GetGroupUsersInterface);
}

}