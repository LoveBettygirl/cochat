/*************************************************************
 * read_offline.cpp
 * Generated by corpc framework corpc_gen.py
 * Create Time: 2023-01-05 09:36:18
 * This file will not be overwrite althrough protobuf file changed !!!
 * Just write this file while not exist
*************************************************************/

#include <corpc/common/log.h>
#include "OfflineService/interface/read_offline.h"
#include "OfflineService/pb/OfflineService.pb.h"
#include "OfflineService/dao/offline_msg_dao.h"
#include "OfflineService/common/business_exception.h"
#include "OfflineService/common/error_code.h"


namespace OfflineService {

ReadOfflineInterface::ReadOfflineInterface(const ::ReadOfflineRequest &request, ::ReadOfflineResponse &response)
    : request_(request), 
    response_(response)
{

}

ReadOfflineInterface::~ReadOfflineInterface()
{

}

void ReadOfflineInterface::run()
{
    //
    // Run your business at here
    // response_.set_ret_code(0);
    // response_.set_res_info("Succ");
    //
    int userid = request_.user_id();

    OfflineMsgDao dao;
    for (const auto &msg : dao.query(userid)) {
        response_.add_msg(msg.c_str());
    }

    if (!dao.remove(userid)) {
        throw BusinessException(REMOVE_OFFLINE_MSG_FAILED, getErrorMsg(REMOVE_OFFLINE_MSG_FAILED), __FILE__, __LINE__);
    }
}

}