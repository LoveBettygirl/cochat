/*************************************************************
 * test_get_user_info_client.cpp
 * Generated by corpc framework corpc_gen.py
 * Create Time: 2022-12-24 08:41:49
 * This file will not be overwrite althrough protobuf file changed !!!
 * Just write this file while not exist
 *************************************************************/

#include <google/protobuf/service.h>
#include <corpc/net/pb/pb_rpc_client_block_channel.h>
#include <corpc/net/pb/pb_rpc_controller.h>
#include <corpc/net/pb/pb_rpc_closure.h>
#include <corpc/net/net_address.h>
#include <corpc/common/start.h>
#include "FriendService/pb/FriendService.pb.h"

void testClient()
{
    corpc::IPAddress::ptr addr = std::make_shared<corpc::IPAddress>("0.0.0.0", 39999);

    corpc::PbRpcClientBlockChannel channel(addr);
    FriendServiceRpc_Stub stub(&channel);

    corpc::PbRpcController rpcController;
    rpcController.SetTimeout(5000);

    ::UserInfoRequest rpcReq;
    ::UserInfoResponse rpcRes;

    std::cout << "Send to FriendService server " << addr->toString() << ", request body: " << rpcReq.ShortDebugString() << std::endl;
    stub.GetUserInfo(&rpcController, &rpcReq, &rpcRes, NULL);

    if (rpcController.ErrorCode() != 0) {
        std::cout << "Failed to call FriendService server, error code: " << rpcController.ErrorCode() << ", error info: " << rpcController.ErrorText() << std::endl;
        return;
    }

    std::cout << "Success get response from FriendService server " << addr->toString() << ", response body: " << rpcRes.ShortDebugString() << std::endl;
}

int main(int argc, char *argv[])
{
    if (argc != 2) {
        printf("Start FriendService test client error, input argc is not 2!");
        printf("Start FriendService like this: \n");
        printf("./test_get_user_info_client FriendService.yml\n");
        return 0;
    }

    corpc::initConfig(argv[1]);

    testClient();

    return 0;
}